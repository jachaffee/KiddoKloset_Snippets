<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="utf-8">
	<title>Database Test</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
</head>
<body>
	<div class="jumbotron text-center">
  		<h1>User Recognition Test</h1>
  		<p>Gosh! I really hope this works!</p> 
	</div>

	<div class="container">
		
		<div class="panel panel-default">
  			<div class="panel-heading">Current User</div>
  			<div class="panel-body">
				<form>
  					<div class="form-group">
    					<label for="name-input">Name:</label>
    					<input type="text" class="form-control" id="user">
  					</div>
  					<div class="form-group">
    					<label for="gender-input">Gender:</label>
    					<input type="text" class="form-control" id="gender">
  					</div>
  					<div class="form-group">
    					<label for="location-input">Location:</label>
    					<input type="text" class="form-control" id="location">
  					</div>
  					<button class="btn btn-primary" id="add-user-btn" type="submit">Submit</button>
				</form>

  			</div>
		</div>
	</div>

	<script src="https://www.gstatic.com/firebasejs/4.6.0/firebase.js"></script>
	<script>

  var userName;
  var userGender;
  var userLocation;
  var userID = 1;

  var config = {
    apiKey: "AIzaSyD9NnsfPf4Mnu6lOdxV7GvsqOiChF9Ak1k",
    authDomain: "project1-practice.firebaseapp.com",
    databaseURL: "https://project1-practice.firebaseio.com",
    projectId: "project1-practice",
    storageBucket: "",
    messagingSenderId: "904406699956"
  };
  firebase.initializeApp(config);

  var database = firebase.database();


  var connectionsRef = database.ref("/connections");

  var connectedRef = database.ref(".info/connected");

  connectedRef.on("value", function(snap) {
  
    if (snap.val()) {

      var con = connectionsRef.push(true);

      con.onDisconnect().remove();
    }

  });

  database.ref("/userData").on("value", function(snapshot) {

  if (snapshot.child("userID").exists() && connectionsRef === true) {

    userName = snapshot.val().name;
    userGender = snapshot.val().gender;
    userLocation = snapshot.val().location;

    $(".panel-body").append("<p>Welcome " + userName + "!</p><p>You are a " + userGender + "!</p><p>You live in " + userLocation + "!");
    //set variables for gender, location, and avatar to match saved values

  //else {}
    //redirect to sign-in screen
  


  
  $("#add-user-btn").on("click", function(event) {
    event.preventDefault();

    var newName = $("#name-input").val().trim();
    var newGender = $("#gender-input").val().trim();
    var newLocation = $("#location-input").val().trim();


    var newUser = {
      name: newName,
      gender: newGender,
      location: newLocation,
      id: userID
    };

    database.ref("/userData" + userID).push(newUser);
    userID++;
  })
		


	</script>
</body>
</html>